# Functor Engine

## æ”¹å–„è¦ä»¶

- ç’°å¢ƒå¤‰æ•°ç®¡ç†: Gemini.env ã®å‹•çš„ãƒ‘ã‚¹è§£æ±º
- PyVisã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†: viz_helper.py:48-54 ã§é©åˆ‡ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- Streamlitã®çŠ¶æ…‹ç®¡ç†: FastAPIã‚’ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã«ä¿ã¡ã¤ã¤ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ã‚°ãƒ©ãƒ•ã‚’ä¿æŒ
- å¿…é ˆã§ã¯ãªã„ãŒæœ›ã¾ã—ã„æ”¹å–„:
    - WorldNode â†’ WorldObject ã«å‘½åã‚’çµ±ä¸€ï¼ˆä»•æ§˜æ›¸æº–æ‹ ï¼‰
    - backend/routers/api.py ã‚’åˆ†é›¢ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š
    - Docker Compose ã®è¿½åŠ ï¼ˆä¸€ç™ºèµ·å‹•ã®å®Ÿç¾ï¼‰
- æ¦‚å¿µãƒ¬ãƒ™ãƒ«ã§ã®æ¤œè¨¼ãŒå¿…è¦:
    - åœè«–çš„æ§‹é€ ã®å½¢å¼æ€§: åˆæˆå‰‡ãƒ»æ’ç­‰å°„ã®å®Ÿè£…ï¼ˆç¾æ™‚ç‚¹ã§ã¯æš—é»™çš„ï¼‰

## ä¿®æ­£è¦ä»¶

ä¸‹è¨˜ã«æç¤ºã—ãŸUI Layoutæ¡ˆã‹ã‚‰å…¨ä½“ã®ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã®ä¿®æ­£ã‚’è¡Œã†ã“ã¨

- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ã—ä¸‹è¨˜ã®é …ç›®ã‚’é…ç½®
    - åˆæœŸæƒ…å ±
    - ç–é€šç¢ºèª
    - Github Repository
- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä¸‹è¨˜ã®3ã‚«ãƒ©ãƒ ã«ä¿®æ­£
    - ä¸–ç•Œè¦³å®šç¾©
        - å…¥åŠ›æƒ…å ±ã®åˆ‡ã‚Šæ›¿ãˆ
            - ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
            - æ–‡ç« ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠžï¼ˆmarkdownã€æœ€å¤§10ãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§ã®è¤‡æ•°é¸æŠžã«ã™ã‚‹ã®ãŒæœ›ã¾ã—ã„ï¼‰
        - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    - å¤‰æ›å¯¾è±¡
        - å…¥åŠ›æƒ…å ±ã®åˆ‡ã‚Šæ›¿ãˆ
            - ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
            - æ–‡ç« ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠžï¼ˆmarkdownã€æœ€å¤§10ãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§ã®è¤‡æ•°é¸æŠžã«ã™ã‚‹ã®ãŒæœ›ã¾ã—ã„ï¼‰
            - ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«é¸æŠž
        - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        - æ‹¡å¼µæ©Ÿèƒ½
            - ä¸–ç•Œè¦³ã®å½±éŸ¿åº¦
            - æ™‚ç³»åˆ—ã®é€²è¡Œåº¦
    - ç”Ÿæˆçµæžœ
        - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
- Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ç™»éŒ²æ©Ÿèƒ½ã‚’è¿½åŠ 
    - è¿½åŠ å¯¾è±¡
        - ä¸–ç•Œè¦³å®šç¾©
        - å¤‰æ›å¯¾è±¡
- å…¨ä½“ã®UIãƒ‡ã‚¶ã‚¤ãƒ³
    - è‰²
        - ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼: #1c1a47
        - ã‚µãƒ–ã‚«ãƒ©ãƒ¼: #514fd3
        - å¼·èª¿è‰²: #8e3cd8
        - ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼: #ffffff
        - èƒŒæ™¯è‰²ã¯ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ã‚’åŸºã«å‘¨è¾ºæ¸›å…‰ã¨ãªã‚‹ã‚ˆã†ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‹ã‘ã‚‹

ä»¥ä¸‹ã¯ä¿®æ­£æ¡ˆã®ä¸€éƒ¨ã‚’æ¦‚å¿µçš„ã«è¨˜è¼‰ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚
å®Ÿéš›ã®å®Ÿè£…æ™‚ã«ã¯æ§‹æˆã‚’å‚ç…§ã—ã¤ã¤æ©Ÿèƒ½ã™ã‚‹ã‚ˆã†ã«é©åˆ‡ãªå®Ÿè£…ã‚’è¡Œã†ã“ã¨ã€‚

```python
import streamlit as st
import markdown
import glob

# Page Config
st.set_page_config(
    page_title="Functor Engine",
    page_icon="ðŸ”®",
    layout="wide",
    initial_sidebar_state="expanded"
)

# --- Sidebar: World Management ---
st.sidebar.title("ðŸ”® Functor Engine Info")

st.sidebar.markdown("---")
st.sidebar.subheader("åˆæœŸæƒ…å ±")
st.sidebar.button("åˆæœŸåŒ–")
st.sidebar.info("Initialized Status: ")

st.sidebar.markdown("---")
st.sidebar.subheader("ç–Žé€šç¢ºèª")
st.sidebar.button("å®Ÿè¡Œ")
st.sidebar.info("Categorize Test: ")
st.sidebar.info("Generated Test: ")

st.sidebar.markdown("---")
st.sidebar.subheader("Github Repository")
st.sidebar.button("Link")

# --- Main Area ---
st.title("ðŸ”® Functor Engine")
st.markdown("---")

col1, col2, col3 = st.columns([1, 1, 1])

with col1:
    st.subheader("ï¼‘ï¼Žä¸–ç•Œè¦³ã‚’å®šç¾©")
    
    col1tab1, col1tab2 = st.tabs(["text" ,"file"])
    with col1tab1:
        world_def_input = st.text_area(
        "Define your World (Text/Markdown)",
        height=200,
        placeholder="Example:\nIn the Kingdom of Aethelgard, magic flows from the Crystal Spire. The King rules with an iron fist, but the Rebellion of the Red Rose is growing..."
        )
    with col1tab2:
        uploaded_file = st.file_uploader("Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", type="md", key="category")
        if uploaded_file is not None:
            with io.open(file_path, mode="r", encoding="utf-8") as f:
                df = f.open(uploaded_file)
                st.write("ãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:")
                st.dataframe(df.head())

    st.info("File Status: ")

with col2:
    st.subheader("ï¼’ï¼Žå¤‰æ›å¯¾è±¡")
    col2tab1, col2tab2, col2tab3 = st.tabs(["text" ,"file" ,"image"])
    
    with col2tab1:
        input_text = st.text_area("Enter text to translate:", height=150, placeholder="I went to the convenience store to buy some rice balls.")
    with col2tab2:
        input_file = st.file_uploader("Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", type="md", key="input")
        if input_file is not None:
            with io.open(file_path, mode="r", encoding="utf-8") as f:
                df = f.open(input_file)
                st.write("ãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:")
                st.dataframe(df.head())
        st.info("File Status: ")
    with col2tab3:
        st.warning("å®Ÿè£…äºˆå®š")

    on = st.toggle("æ‹¡å¼µæ©Ÿèƒ½", False, key="expand")
    if on:
        st.slider("ä¸–ç•Œè¦³ã®å½±éŸ¿åº¦", 1, 100, 100, key="effort")
        st.slider("æ™‚ç³»åˆ—ã®é€²è¡Œåº¦", 1, 100, 1, key="timeline")

with col3:
    st.subheader("ï¼“ï¼Žç”Ÿæˆçµæžœ")
    if st.button("Translate to World"):
        if not input_text.strip():
            st.warning("Please enter some text.")
        else:
            with st.spinner("Consulting the Laws of the World..."):
                result = api.translate(input_text)
                
                if "error" in result:
                    st.error(f"Translation Failed: {result['error']}")
                else:
                    st.success("Translation Complete!")
                    st.markdown("### Result")
                    st.markdown(f"> {result['translated_text']}")
                    
                    with st.expander("See Applied Laws"):
                        for law in result.get('applied_laws', []):
                            st.text(law)    
    if st.button("Refresh Graph"):
        st.rerun()
```